<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>ãƒ‡ã‚¤ãƒªãƒ¼ã‚¬ãƒãƒ£ â€” è±ªè¯æ¼”å‡ºç‰ˆ</title>
<style>
  :root{
    --bg1:#051025; --bg2:#08122a;
    --card:#071226; --accent:#ffb86b; --accent2:#ffd166;
    --muted:#9fb0c8; --glass: rgba(255,255,255,0.03);
    --gold: linear-gradient(90deg,#ffd76b,#ffb86b);
  }
  html,body{height:100%;}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;
    background: radial-gradient(1200px 600px at 10% 20%, rgba(124,92,255,0.08), transparent), linear-gradient(180deg,var(--bg1),var(--bg2));
    color:#e6eef8; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    display:flex; align-items:center; justify-content:center; padding:18px;
  }
  .app{width:100%; max-width:460px; border-radius:18px; overflow:hidden; position:relative;}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06)); box-shadow: 0 18px 60px rgba(2,6,23,0.6); border-radius:18px; overflow:hidden}
  header{padding:18px; display:flex; gap:12px; align-items:center;}
  .logo{width:64px;height:64px;border-radius:14px;background:linear-gradient(135deg,#ffd76b,#ff9f43);display:flex;align-items:center;justify-content:center;font-weight:900;font-size:22px;color:#2b1a00;box-shadow:0 10px 30px rgba(255,167,38,0.14);transform:rotate(-8deg)}
  header h1{margin:0;font-size:18px}
  header p{margin:0;font-size:12px;color:var(--muted)}

  main{padding:12px 16px 20px}
  .info{display:flex;gap:10px;margin-bottom:12px}
  .card{flex:1;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.03));padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
  .card h3{margin:0 0 6px 0;font-size:13px}
  .card p{margin:0;font-size:12px;color:var(--muted)}

  .prob-table{display:flex;gap:8px;margin-bottom:12px;overflow:auto;padding-bottom:4px}
  .prob{flex:0 0 auto;min-width:96px;background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(0,0,0,0.04));padding:10px;border-radius:12px;text-align:center;position:relative;border:1px solid rgba(255,255,255,0.03)}
  .prob .money{font-weight:800;font-size:14px}
  .prob .fakepct{font-size:12px;color:var(--muted);margin-top:6px}
  .prob::after{content:'';position:absolute;left:50%;bottom:-6px;width:60%;height:6px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.0));transform:translateX(-50%);border-radius:6px}

  .gacha-wrap{display:flex;flex-direction:column;align-items:center;gap:12px}
  .stage{width:100%;border-radius:14px;padding:12px;background:linear-gradient(180deg, rgba(124,92,255,0.04), rgba(0,0,0,0.04));box-shadow:inset 0 -6px 24px rgba(0,0,0,0.3)}

  .reel{position:relative;width:100%;height:140px;border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(0,0,0,0.06));}
  .reel::before{content:'';position:absolute;left:0;top:0;right:0;height:40%;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0));pointer-events:none}
  .reel-inner{position:absolute;left:0;right:0;top:0;will-change:transform}
  .reel-item{height:70px;display:flex;align-items:center;gap:12px;padding:10px 14px;box-sizing:border-box;border-bottom:1px dashed rgba(255,255,255,0.02)}
  .icon{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center;font-size:24px;box-shadow: 0 8px 26px rgba(2,6,23,0.6);}
  .label{font-weight:900}
  .sub{font-size:12px;color:var(--muted)}

  .center-marker{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:88%;height:0;border-top:36px solid rgba(255,255,255,0.02);border-left:14px solid transparent;border-right:14px solid transparent;pointer-events:none}

  .controls{display:flex;gap:10px;width:100%;margin-top:6px}
  button{flex:1;padding:14px 16px;border-radius:12px;border:0;font-weight:900;font-size:15px;cursor:pointer;background:linear-gradient(90deg,#ffd76b,#ff9f43);color:#2b1a00;box-shadow:0 12px 40px rgba(255,155,50,0.12);}
  button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:700}
  button[disabled]{opacity:0.5;cursor:not-allowed}

  .result{margin-top:10px;padding:12px;border-radius:12px;min-height:70px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.04));display:flex;align-items:center;gap:12px;justify-content:center}
  .result .big{font-size:26px}
  .rarity-gold{box-shadow:0 8px 40px rgba(255,190,60,0.12);border:1px solid rgba(255,210,120,0.25);padding:10px;border-radius:12px;background:linear-gradient(90deg,#fff2d6,#fff0c4)}

  /* shiny animation */
  .shimmer{position:relative;overflow:hidden}
  .shimmer::after{content:'';position:absolute;left:-120%;top:0;width:40%;height:200%;transform:skewX(-18deg);background:linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,0.18), rgba(255,255,255,0));animation:shine 2.6s linear infinite}
  @keyframes shine{from{left:-120%}to{left:140%}}

  /* confetti canvas on top */
  #confettiCanvas{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:60}

  footer{padding:10px 14px;font-size:12px;color:var(--muted);display:flex;justify-content:space-between;gap:10px;align-items:center}

  /* small screens */
  @media (max-width:420px){
    .reel{height:120px}
    .reel-item{height:60px}
    .icon{width:48px;height:48px;font-size:20px}
  }
</style>
</head>
<body>
  <div class="app">
    <canvas id="confettiCanvas"></canvas>
    <div class="panel" role="application" aria-label="ãƒ‡ã‚¤ãƒªãƒ¼ã‚¬ãƒãƒ£">
      <header>
        <div class="logo">G</div>
        <div>
          <h1>ãƒ‡ã‚¤ãƒªãƒ¼ã‚¬ãƒãƒ£ â€” è±ªè¯æ¼”å‡º</h1>
          <p>1æ—¥1å›ã ã‘æŒ‘æˆ¦ã§ãã¾ã™ã€‚å®Ÿéš›ã®æ’å‡ºç¢ºç‡ã¯è¡¨ç¤ºã—ã¦ã„ã¾ã›ã‚“ã€‚</p>
        </div>
      </header>

      <main>
        <div class="info">
          <div class="card">
            <h3>ä»Šæ—¥ã®æŒ‘æˆ¦çŠ¶æ³</h3>
            <p id="statusText">èª­ã¿è¾¼ã¿ä¸­...</p>
          </div>
          <div class="card">
            <h3>æ¬¡ã®è§£æ”¾</h3>
            <p id="nextText">â€”</p>
          </div>
        </div>

        <div class="prob-table" aria-hidden="false" title="è¡¨ç¤ºç¢ºç‡ï¼ˆå½ã®å€¤ï¼‰">
          <div class="prob shimmer"><div class="money">10å††</div><div class="fakepct">è¡¨ç¤º 50%</div></div>
          <div class="prob shimmer"><div class="money">50å††</div><div class="fakepct">è¡¨ç¤º 30%</div></div>
          <div class="prob shimmer"><div class="money">100å††</div><div class="fakepct">è¡¨ç¤º 10%</div></div>
          <div class="prob"><div class="money">500å††</div><div class="fakepct">è¡¨ç¤º 5%</div></div>
          <div class="prob"><div class="money">1000å††</div><div class="fakepct">è¡¨ç¤º 3%</div></div>
          <div class="prob"><div class="money">5000å††</div><div class="fakepct">è¡¨ç¤º 2%</div></div>
          <div class="prob"><div class="money">10000å††</div><div class="fakepct">è¡¨ç¤º 1%</div></div>
        </div>

        <div class="gacha-wrap">
          <div class="stage">
            <div class="reel" aria-hidden="false">
              <div class="reel-inner" id="reelInner" style="transform: translateY(0px);"></div>
              <div class="center-marker"></div>
            </div>
          </div>

          <div class="controls">
            <button id="spinBtn" aria-label="ã‚¬ãƒãƒ£ã‚’å›ã™">ã‚¬ãƒãƒ£ã‚’å›ã™</button>
            <button id="historyBtn" class="secondary">å±¥æ­´</button>
          </div>

          <div class="result" id="resultBox">
            <div id="resultText" class="small">ã‚ˆã†ã“ã â€” è±ªè¯ãªæ¼”å‡ºã§1æ—¥1å›æŒ‘æˆ¦ã§ãã¾ã™ã€‚</div>
          </div>
        </div>

      </main>

      <footer>
        <div id="footNote">â€» å®Ÿéš›ã®æ’å‡ºç¢ºç‡ã¯è¡¨ç¤ºã—ã¦ã„ã¾ã›ã‚“ã€‚</div>
        <div class="small">Â© ãƒ‡ã‚¤ãƒªãƒ¼ã‚¬ãƒãƒ£</div>
      </footer>
    </div>
  </div>

<script>
(() => {
  const PRIZES = [
    { id: 'p10',   name: '10å††',    emoji:'ğŸª™', price:10,    chance:93.00 },
    { id: 'p50',   name: '50å††',    emoji:'ğŸ’ ', price:50,    chance:5.00 },
    { id: 'p100',  name: '100å††',   emoji:'ğŸ”¹', price:100,   chance:1.00 },
    { id: 'p500',  name: '500å††',   emoji:'ğŸ…', price:500,   chance:0.70 },
    { id: 'p1000', name: '1000å††',  emoji:'ğŸ–ï¸', price:1000,  chance:0.15 },
    { id: 'p5000', name: '5000å††',  emoji:'ğŸ†', price:5000,  chance:0.10 },
    { id: 'p10000',name: '10000å††', emoji:'ğŸ‘‘', price:10000, chance:0.05 },
  ];

  const DISPLAY_PCTS = ['50%','30%','10%','5%','3%','2%','1%'];

  const reelInner = document.getElementById('reelInner');
  const spinBtn = document.getElementById('spinBtn');
  const historyBtn = document.getElementById('historyBtn');
  const statusText = document.getElementById('statusText');
  const nextText = document.getElementById('nextText');
  const resultBox = document.getElementById('resultBox');
  const resultText = document.getElementById('resultText');

  const STORAGE_KEY = 'daily_gacha_last_spin_v2';
  const HISTORY_KEY = 'daily_gacha_history_v2';

  // Build reel items
  function buildReelItems(repeat = 10) {
    const frag = document.createDocumentFragment();
    for (let r=0;r<repeat;r++){
      for (let i=0;i<PRIZES.length;i++){
        const p = PRIZES[i];
        const div = document.createElement('div');
        div.className = 'reel-item';
        div.dataset.prize = p.id;
        const isPremium = p.price >= 1000;
        div.innerHTML = `
          <div class="icon ${isPremium ? 'rarity-gold':''}" aria-hidden="true">${p.emoji}</div>
          <div>
            <div class="label">${p.name}</div>
            <div class="sub">è¡¨ç¤ºç¢ºç‡ ${DISPLAY_PCTS[i]}</div>
          </div>
        `;
        frag.appendChild(div);
      }
    }
    reelInner.appendChild(frag);
  }
  buildReelItems(12);

  // cumulative for selection
  const cumulative = [];
  let acc = 0;
  for (const p of PRIZES){ acc += p.chance; cumulative.push({ id:p.id, upto:acc }); }

  function choosePrizeRandom(){
    const r = Math.random() * 100;
    for (const c of cumulative){ if (r <= c.upto) return PRIZES.find(p => p.id === c.id); }
    return PRIZES[0];
  }

  function getTodayKey(){ const d=new Date(); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}` }
  function hasSpunToday(){ try{ const v=localStorage.getItem(STORAGE_KEY); return v===getTodayKey(); }catch(e){return false} }
  function recordSpin(){ try{ localStorage.setItem(STORAGE_KEY,getTodayKey()) }catch(e){} }
  function addHistory(entry){ try{ const raw=localStorage.getItem(HISTORY_KEY); const arr=raw?JSON.parse(raw):[]; arr.unshift(entry); localStorage.setItem(HISTORY_KEY,JSON.stringify(arr.slice(0,30))) }catch(e){} }
  function getHistory(){ try{ const raw=localStorage.getItem(HISTORY_KEY); return raw?JSON.parse(raw):[] }catch(e){return []} }

  function updateStatus(){
    if (hasSpunToday()){
      statusText.textContent = 'ä»Šæ—¥ã®æŒ‘æˆ¦ã¯æ¸ˆã¿ã§ã™ã€‚æ¬¡ã¯æ˜æ—¥ã¾ãŸæŒ‘æˆ¦ã§ãã¾ã™ã€‚';
      spinBtn.textContent = 'ä»Šæ—¥ã®æŒ‘æˆ¦æ¸ˆã¿'; spinBtn.disabled=true;
      const t=new Date(); t.setDate(t.getDate()+1);
      nextText.textContent = `${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,'0')}-${String(t.getDate()).padStart(2,'0')} 00:00`;
    } else {
      statusText.textContent = 'ä»Šæ—¥ã®æŒ‘æˆ¦ã¯ã¾ã ã§ã™ã€‚1æ—¥1å›å›ã›ã¾ã™ã€‚';
      spinBtn.textContent = 'ã‚¬ãƒãƒ£ã‚’å›ã™'; spinBtn.disabled=false; nextText.textContent='â€”';
    }
  }

  // Reel animation with fancy easing and zoom
  function animateToPrize(prizeId){
    const items = Array.from(reelInner.children);
    if (!items.length) return Promise.resolve();
    const totalItems = items.length;
    const middleStart = Math.floor(totalItems * 0.45);
    const middleEnd = Math.floor(totalItems * 0.75);
    let targetIndex = -1;
    for (let i=middleStart;i<=middleEnd;i++){ if (items[i].dataset.prize===prizeId){ targetIndex=i; break; } }
    if (targetIndex===-1){ for (let i=0;i<totalItems;i++){ if (items[i].dataset.prize===prizeId){ targetIndex=i; break; } } }
    if (targetIndex===-1) targetIndex=0;

    const itemHeight = items[0].offsetHeight || 70;
    const reelHeight = document.querySelector('.reel').offsetHeight;
    const centerOffset = (reelHeight/2)-(itemHeight/2);
    const destY = - (targetIndex * itemHeight) + centerOffset;
    const extra = - (totalItems * itemHeight * 4); // more spins
    const finalY = destY + extra;

    return new Promise(resolve=>{
      // add scale animation
      reelInner.style.transition = 'transform 3600ms cubic-bezier(.22,.9,.16,1)';
      reelInner.style.transform = `translateY(${finalY}px) scale(1.02)`;
      const onEnd = ()=>{
        reelInner.removeEventListener('transitionend', onEnd);
        reelInner.style.transition = '';
        const normalizedIndex = targetIndex % PRIZES.length;
        const normalizedY = - (normalizedIndex * itemHeight) + centerOffset;
        // snap and small pop
        reelInner.style.transform = `translateY(${normalizedY}px) scale(1)`;
        setTimeout(()=>{ resolve(); }, 140);
      };
      reelInner.addEventListener('transitionend', onEnd);
    });
  }

  // confetti system
  const confettiCanvas = document.getElementById('confettiCanvas');
  const ctx = confettiCanvas.getContext('2d');
  let confettiPieces = [];
  function resizeCanvas(){ confettiCanvas.width = confettiCanvas.clientWidth; confettiCanvas.height = confettiCanvas.clientHeight; }
  window.addEventListener('resize', resizeCanvas); resizeCanvas();

  function spawnConfetti(xFrac, yFrac, count=40){
    const w = confettiCanvas.width; const h = confettiCanvas.height;
    const x0 = w * xFrac; const y0 = h * yFrac;
    for (let i=0;i<count;i++){
      confettiPieces.push({ x:x0, y:y0, vx:(Math.random()-0.5)*8, vy:(Math.random()*-6)-2, ang:Math.random()*Math.PI*2, va:(Math.random()-0.5)*0.2, size:6+Math.random()*8, color: `hsl(${Math.floor(Math.random()*360)},80%,60%)`, life:120+Math.floor(Math.random()*60) });
    }
  }
  function updateConfetti(){
    ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
    for (let i=confettiPieces.length-1;i>=0;i--){
      const p = confettiPieces[i];
      p.vy += 0.28; p.x += p.vx; p.y += p.vy; p.ang += p.va; p.life--;
      ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.ang);
      ctx.fillStyle = p.color; ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size*0.6);
      ctx.restore();
      if (p.y > confettiCanvas.height+50 || p.life<=0) confettiPieces.splice(i,1);
    }
    requestAnimationFrame(updateConfetti);
  }
  requestAnimationFrame(updateConfetti);

  // sound using WebAudio
  const AudioCtx = window.AudioContext || window.webkitAudioContext;
  const audioCtx = AudioCtx ? new AudioCtx() : null;
  function playTone(freq, duration=0.12, type='sine'){ if (!audioCtx) return; const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type=type; o.frequency.value=freq; g.gain.value=0.0001; o.connect(g); g.connect(audioCtx.destination); const now=audioCtx.currentTime; g.gain.linearRampToValueAtTime(0.18, now+0.01); o.start(now); g.gain.exponentialRampToValueAtTime(0.0001, now+duration); o.stop(now+duration+0.02); }

  async function doSpin(){
    if (hasSpunToday()){ updateStatus(); return; }
    spinBtn.disabled=true; spinBtn.textContent='å›ã—ã¦ã¾ã™â€¦'; resultText.textContent='æŠ½é¸ä¸­â€¦é‹å‘½ã‚’æ¥½ã—ã‚“ã§ãã ã•ã„';

    // small audio flourish
    playTone(420,0.08,'sine'); setTimeout(()=>playTone(520,0.08,'sine'),80);

    const prize = choosePrizeRandom();
    await animateToPrize(prize.id);

    recordSpin(); addHistory({ when:new Date().toISOString(), prize:prize.name, price:prize.price });

    // result display: no actual probability shown
    const rare = prize.price >= 1000; // treat >=1000 as special
    resultText.innerHTML = `\n      <div style="display:flex;align-items:center;gap:12px">\n        <div style="font-size:34px">${prize.emoji}</div>\n        <div style="text-align:left">\n          <div style="font-weight:900;font-size:18px">${prize.name} ã‚’ç²å¾—ï¼</div>\n          <div class="small" style="color:var(--muted)">é‹å‘½ã®ä¸€å›ã§ã™ â€” ãŠã‚ã§ã¨ã†ï¼</div>\n        </div>\n      </div>\n    `;

    // fancy effects for rare
    if (prize.price >= 1000){
      // confetti burst center-top
      spawnConfetti(0.5, 0.25, 80);
      // golden sparkle animation on result box
      resultBox.classList.add('shimmer');
      setTimeout(()=> resultBox.classList.remove('shimmer'), 4200);
      // sound
      playTone(720,0.18,'sawtooth'); setTimeout(()=>playTone(980,0.24,'sine'),140);
    } else {
      // small sparkle & coin jingle
      spawnConfetti(0.5, 0.35, 18);
      playTone(520,0.12,'triangle');
    }

    updateStatus();
  }

  spinBtn.addEventListener('click', async ()=>{ if (spinBtn.disabled) return; // resume audio context on gesture
    if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume(); await doSpin(); });
  historyBtn.addEventListener('click', ()=>{
    const hist = getHistory(); if (!hist.length) return alert('ã¾ã å¼•ã„ãŸå±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚');
    const lines = hist.map(h=>{ const d=new Date(h.when); return `${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')} â€” ${h.prize}`; });
    alert('ç›´è¿‘ã®å±¥æ­´ï¼ˆæœ€å¤§30ä»¶ï¼‰:\n\n' + lines.join('\n'));
  });

  function initReelPosition(){ const items = Array.from(reelInner.children); if (!items.length) return; const itemHeight = items[0].offsetHeight || 70; const startIndex = Math.floor(items.length*0.5); const reelHeight=document.querySelector('.reel').offsetHeight; const centerOffset=(reelHeight/2)-(itemHeight/2); const y = - (startIndex*itemHeight) + centerOffset; reelInner.style.transform = `translateY(${y}px)`; }
  window.addEventListener('load', ()=>{ setTimeout(()=>{ initReelPosition(); updateStatus(); const hist = getHistory(); if (hist && hist.length>0){ const last = hist[0]; const d = new Date(last.when); if (d.toISOString().slice(0,10) === new Date().toISOString().slice(0,10)){ resultText.innerHTML = `<div style="display:flex;align-items:center;gap:12px"><div style="font-size:28px">${PRIZES.find(p=>p.name===last.prize)?.emoji || 'ğŸª™'}</div><div style="text-align:left"><div style="font-weight:900">${last.prize} ã‚’ç²å¾—æ¸ˆã¿ï¼ˆæœ¬æ—¥ï¼‰</div><div class="small" style="color:var(--muted)">å–å¾—æ—¥æ™‚: ${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}</div></div></div>`; } } },120); });

  // start confetti loop
  requestAnimationFrame(updateConfetti);

  // note: uses local time â€” users can change device clock to bypass; server checks are recommended for production
})();
</script>
</body>
</html>
